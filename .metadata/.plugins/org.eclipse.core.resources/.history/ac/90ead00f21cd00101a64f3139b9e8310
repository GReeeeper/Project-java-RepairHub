package presentation;

import javax.swing.*;
import metier.models.User;
import metier.services.UserService;

public class LoginPanel extends JPanel {
    private final UserService userService = new UserService();

    public LoginPanel() {
        JButton loginBtn = new JButton("Login");
        JTextField usernameField = new JTextField(15);
        JPasswordField passwordField = new JPasswordField(15);

        loginBtn.addActionListener(e -> {
            try {
                User user = userService.login(usernameField.getText(), new String(passwordField.getPassword()));
                JOptionPane.showMessageDialog(this, "Welcome " + user.getUsername());

                switch(user.getRole()) {
                    case OWNER, BOTH -> new OwnerPanel(user).setVisible(true);
                    case REPAIRER -> new RepairerPanel(user).setVisible(true);
                }
            } catch (Exception ex) {
                JOptionPane.showMessageDialog(this, "Login failed: " + ex.getMessage());
            }
        });

        add(usernameField);
        add(passwordField);
        add(loginBtn);
    }
}
