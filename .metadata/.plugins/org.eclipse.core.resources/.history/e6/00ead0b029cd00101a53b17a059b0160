package dao;

import metier.models.Shop;
import metier.models.User;
import java.util.ArrayList;
import java.util.Collections;
import java.util.List;

public class ShopDAO {
    private static final List<Shop> shops = new ArrayList<>();

    public void addShop(Shop shop) {
        if (shop != null) shops.add(shop);
    }

    public Shop getShopByName(String name) {
        if (name == null) return null;
        return shops.stream()
                .filter(s -> s != null && s.getName() != null && s.getName().equalsIgnoreCase(name))
                .findFirst()
                .orElse(null);
    }

    public Shop getShopByOwner(User owner) {
        if (owner == null) return null;
        return shops.stream()
                .filter(s -> s != null && s.getOwner() != null && s.getOwner().equals(owner))
                .findFirst()
                .orElse(null);
    }

    // NEW: find the shop that contains the given repairer in its repairers list
    public Shop getShopByRepairer(User repairer) {
        if (repairer == null) return null;
        return shops.stream()
                .filter(s -> s != null && s.getRepairers() != null && s.getRepairers().contains(repairer))
                .findFirst()
                .orElse(null);
    }

    public List<Shop> getAllShops() {
        return Collections.unmodifiableList(new ArrayList<>(shops));
    }

    public void updateShop(Shop shop) {
        // no-op for in-memory list (but you may implement replace logic if needed)
    }

    public void updateCash(double amount, Shop shop) {
        if (shop != null) {
            shop.updateCash(amount);
        }
    }
}
