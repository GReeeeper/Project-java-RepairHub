package presentation;

import metier.models.*;
import metier.services.BusinessService;

import javax.swing.*;
import java.awt.*;

public class OwnerPanel extends JPanel {
    private final User owner;
    private final BusinessService service;

    private JTextArea taInfo;
    private JButton btnViewShop, btnAddRepairer;

    public OwnerPanel(User owner, BusinessService service) {
        this.owner = owner;
        this.service = service;

        setLayout(new BorderLayout());

        JPanel topPanel = new JPanel(new FlowLayout());
        topPanel.setBorder(BorderFactory.createTitledBorder("Owner & Shop Info"));

        btnViewShop = new JButton("View Shop");
        btnAddRepairer = new JButton("Add Repairer");

        topPanel.add(btnViewShop);
        topPanel.add(btnAddRepairer);

        add(topPanel, BorderLayout.NORTH);

        taInfo = new JTextArea(20, 50);
        taInfo.setEditable(false);
        add(new JScrollPane(taInfo), BorderLayout.CENTER);

        btnViewShop.addActionListener(e -> viewShop());
        btnAddRepairer.addActionListener(e -> addRepairer());
    }

    private void viewShop() {
        Shop shop = service.getShopByOwner(owner);
        if (shop == null) {
            taInfo.setText("No shop found.");
            return;
        }
        StringBuilder sb = new StringBuilder();
        sb.append("Shop Name: ").append(shop.getName()).append("\n");
        sb.append("Cash: ").append(shop.getRawCash()).append("\n");
        sb.append("Repairers:\n");
        for (User r : shop.getRepairers()) {
            sb.append(" - ").append(r.getUsername()).append("\n");
        }
        taInfo.setText(sb.toString());
    }

    private void addRepairer() {
        Shop shop = service.getShopByOwner(owner);
        if (shop == null) {
            JOptionPane.showMessageDialog(this, "You must have a shop first!");
            return;
        }

        try {
            String username = JOptionPane.showInputDialog(this, "Repairer Username:");
            String password = JOptionPane.showInputDialog(this, "Password:");
            String email = JOptionPane.showInputDialog(this, "Email:");
            String phone = JOptionPane.showInputDialog(this, "Phone:");

            service.addRepairer(username, password, email, phone, shop);
            JOptionPane.showMessageDialog(this, "Repairer added successfully!");
            viewShop();

        } catch (Exception ex) {
            JOptionPane.showMessageDialog(this, "Error: " + ex.getMessage());
        }
    }
}
